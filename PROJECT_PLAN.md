# Flow 线程池/任务调度框架规划

## 目标
- 打造可复用的 C++17 线程池与任务调度框架，支持提交普通/延时/优先级/依赖任务，并提供安全停止和基本监控。

## 需求草案
- 固定线程数线程池，支持提交任务，优雅关闭。
- 任务返回值：使用 future 获取执行结果与异常。
- 调度增强：延时任务、可选优先级、任务依赖（DAG）。
- 可观测性：统计队列长度、执行数量/耗时，基础日志/事件钩子。
- 停止语义：区分 graceful 与 immediate 停止，确保资源释放。

## 设计思路（迭代推进）
1. 基础线程池：集中队列 + 条件变量，优雅关闭。
2. 返回值支持：packaged_task 封装，返回 future。
3. 延时/定时：最小堆（按到期时间），配合条件变量定时等待。
4. 优先级：基于堆或多队列（如高/低优先级分队列）。
5. 依赖：简单 DAG，引用计数入度，入度为 0 时入队。
6. 工作窃取（可选）：每线程双端队列，提升吞吐与局部性。
7. 健壮性与监控：超时、取消、统计指标输出/回调。

## 当前进度（更新于本次提交）
- ✅ CMake 调整，新增 thread_pool 源文件。
- ✅ 最小线程池实现（集中队列 + future 支持，优雅关闭）。
- ✅ 示例：`main.cpp` 提交多个任务并收集结果。
- ✅ 基础/压力测试：`test_basic` 验证返回值与异常传播；`test_stress` 提交 10 万个轻量任务计数。
- ⏳ 待办：延时/优先级、任务依赖、监控指标、停止语义扩展、工作窃取探索。

## 下一步建议
- 扩展延时调度：为任务增加到期时间，使用最小堆管理唤醒。
- 设计任务描述体（id/优先级/截止时间），为监控与取消留钩子。
- 增加关闭语义测试（graceful/immediate），以及异常/超时的更多场景。
